<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>学生一覧</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        max-width: 960px;
        margin: 2rem auto;
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      }
      table {
        border-collapse: collapse;
        width: 100%;
      }
      th,
      td {
        border: 1px solid #e5e7eb;
        padding: 0.5rem;
        text-align: left;
      }
      th {
        background: #f9fafb;
      }
      .toolbar {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        margin-bottom: 1rem;
      }
      .pager {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        margin-top: 1rem;
      }
      a.btn,
      button.btn {
        display: inline-block;
        padding: 0.4rem 0.7rem;
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        background: #fff;
        color: #111827;
        text-decoration: none;
      }
      a.btn[aria-disabled="true"] {
        opacity: 0.5;
        pointer-events: none;
      }
      .muted {
        color: #6b7280;
      }
      .search-form {
        margin-left: auto;
        display: flex;
        gap: 0.5rem;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <header class="toolbar">
      <h1 style="margin: 0">学生一覧</h1>
      <span class="muted" th:text="'全 ' + ${page.totalElements} + ' 件'">全 0 件</span>
      <form method="get" th:action="@{/students}" class="search-form">
        <input type="hidden" name="sort" th:value="${sort}" />
        <input type="hidden" name="dir" th:value="${dir}" />
        <input type="hidden" name="size" th:value="${page.size}" />
        <label class="muted" for="classId">クラス:</label>
        <select name="classId" id="classId">
          <option value="" th:selected="${classId} == null">すべて</option>
          <option th:each="c : ${classes}"
                  th:value="${c.id}"
                  th:text="${c.name}"
                  th:selected="${classId} != null and c.id == classId"></option>
        </select>
        <input name="q" type="search" placeholder="氏名/学籍番号で検索" th:value="${q}" />
        <button class="btn" type="submit">適用</button>
      </form>
    </header>

    <table>
      <thead>
        <tr>
          <th>
            <a
              th:href="@{'/students'(sort='id',dir=${sort=='id'? toggleDir : dir},page=${page.number},size=${page.size},q=${q},classId=${classId})}"
              >ID</a
            >
            <span class="muted" th:if="${sort=='id'}" th:text="dir=='asc'?'▲':'▼'"></span>
          </th>
          <th>
            <a
              th:href="@{'/students'(sort='studentNumber',dir=${sort=='studentNumber'? toggleDir : dir},page=${page.number},size=${page.size},q=${q},classId=${classId})}"
              >学籍番号</a
            >
            <span
              class="muted"
              th:if="${sort=='studentNumber'}"
              th:text="dir=='asc'?'▲':'▼'"
            ></span>
          </th>
          <th>
            <a
              th:href="@{'/students'(sort='name',dir=${sort=='name'? toggleDir : dir},page=${page.number},size=${page.size},q=${q},classId=${classId})}"
              >氏名</a
            >
            <span class="muted" th:if="${sort=='name'}" th:text="dir=='asc'?'▲':'▼'"></span>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="s : ${page.content}">
          <td th:text="${s.id}">1</td>
          <td th:text="${s.studentNumber}">S0001</td>
          <td th:text="${s.name}">山田 太郎</td>
        </tr>
        <tr th:if="${#lists.isEmpty(page.content)}">
          <td colspan="3" class="muted">データがありません</td>
        </tr>
      </tbody>
    </table>

    <nav class="pager">
      <a
        class="btn"
        th:href="@{'/students'(page=${page.number-1},size=${page.size},sort=${sort},dir=${dir},q=${q},classId=${classId})}"
        th:aria-disabled="${page.first}"
        th:classappend="${page.first}?' disabled'"
        >前へ</a
      >
      <span
        class="muted"
        th:text="${page.number+1} + ' / ' + ${page.totalPages==0?1:page.totalPages}"
        >1 / 1</span
      >
      <a
        class="btn"
        th:href="@{'/students'(page=${page.number+1},size=${page.size},sort=${sort},dir=${dir},q=${q},classId=${classId})}"
        th:aria-disabled="${page.last}"
        th:classappend="${page.last}?' disabled'"
        >次へ</a
      >

      <span class="muted" style="margin-left: auto">表示件数:</span>
      <a class="btn" th:href="@{'/students'(page=0,size=10,sort=${sort},dir=${dir},q=${q},classId=${classId})}">10</a>
      <a class="btn" th:href="@{'/students'(page=0,size=20,sort=${sort},dir=${dir},q=${q},classId=${classId})}">20</a>
      <a class="btn" th:href="@{'/students'(page=0,size=50,sort=${sort},dir=${dir},q=${q},classId=${classId})}">50</a>
    </nav>
  </body>
</html>
